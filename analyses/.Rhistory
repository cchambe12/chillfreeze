chill2 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 4] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill2", "[", i, "]", sep="")
}
chill2$parameter<-new.names
mod.ranef <- full_join(mod.ranef, chill2)
txchill1 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 5] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill1", "[", i, "]", sep="")
}
txchill1$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill1)
txchill2 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 6] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill2", "[", i, "]", sep="")
}
txchill2$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill2)
modoutput <- tidy(modelhere, prob=c(0.9))
#quartz()
source("exp_muplot_brms90.R")
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-22, 22) , 23.5, 3.5) ## ht final
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-8, 8) , 9, 3.5) ## tot biomass
muplotfx(modelhere, "", 8, 8, c(0,5), c(-1, 1) , 1.1, 3.5) ### root to shoot and growth rate
figpathmore <- "roottoshoot90_brms" ### change based on model
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-22, 22) , 23.5, 3.5) ## ht final
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-8, 8) , 9, 3.5) ## tot biomass
muplotfx(modelhere, "", 8, 8, c(0,5), c(-1, 1) , 1.1, 3.5) ### root to shoot and growth rate
#### Now for mu plots based of bb_analysis/models_stan_plotting.R ###
figpath <- "figures"
figpathmore <- "roottoshoot90_brms" ### change based on model
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-22, 22) , 23.5, 3.5) ## ht final
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-8, 8) , 9, 3.5) ## tot biomass
muplotfx(modelhere, "", 8, 8, c(0,5), c(-1, 1) , 1.1, 3.5) ### root to shoot and growth rate
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(rstan)
library(dplyr)
library(broom)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
## load the model
#load("stan/dvr_brms.Rdata")
#load("stan/gslengthlo_brms_adjusted.Rdata")
#load("stan/meristem_brms.Rdata")
#load("stan/chlavg_brms.Rdata")
#load("stan/toughness_brms.Rdata")
#load("stan/htfinal_brms.Rdata")
#load("stan/htfinalrate_brms.Rdata")
#load("stan/totbiomass_brms.Rdata")
#load("stan/biomassrate_brms.Rdata")
load("stan/roottoshoot_brms.Rdata")
#load("stan/chlavg_brms.Rdata")
#load("stan/toughness_brms.Rdata")
load("stan/thickness_brms.Rdata")
chill.stan <- read.csv("output/clean_dvr_traits.csv")
#chill.stan$gslength.lo <- chill.stan$bset - chill.stan$leafout
#chill.stan <- chill.stan[!is.na(chill.stan$dvr),]
chill.stan$species.name <- NA
chill.stan$species.name <- ifelse(chill.stan$species=="ACESAC", "Acer saccharinum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="ALNRUG", "Alnus rugosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPAP", "Betula papyrifera", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPOP", "Betula populifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="CORRAC", "Cornus racemosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SALPUR", "Salix purpurea", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SORAME", "Sorbus americana", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="VIBDEN", "Viburnum dentatum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="FAGGRA", "Fagus grandifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="NYSSYL", "Nyssa sylvatica", chill.stan$species.name)
rmspp <- c("FAGGRA", "NYSSYL")
chill.stan <- chill.stan[!(chill.stan$species%in%rmspp),]
#### Now for mu plots based of bb_analysis/models_stan_plotting.R ###
figpath <- "figures"
figpathmore <- "thickness90_brms" ### change based on model
cols <- adjustcolor("indianred3", alpha.f = 0.3)
my.pal <- rep(brewer.pal(n = 10, name = "Paired"), 8)
# display.brewer.all()
alphahere = 0.4
#xlab <- expression(paste("Model estimate of change in chlorophyll content (mg/", cm^2, ")"))
#xlab <- "Model estimate of change in leaf toughness (N)"
mu <- expression(mu)
xlab <- expression(paste("Model estimate of change in leaf thickness (", mu, "m)", sep="")) ## change based on model
spp <- unique(chill.stan$species)
modelhere <- thickness.mod
tx <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 2] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select(mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx", "[", i, "]", sep="")
}
tx$parameter<-new.names
chill1 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 3] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill1", "[", i, "]", sep="")
}
chill1$parameter<-new.names
mod.ranef<-full_join(tx, chill1)
chill2 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 4] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill2", "[", i, "]", sep="")
}
chill2$parameter<-new.names
mod.ranef <- full_join(mod.ranef, chill2)
txchill1 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 5] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill1", "[", i, "]", sep="")
}
txchill1$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill1)
txchill2 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 6] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill2", "[", i, "]", sep="")
}
txchill2$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill2)
modoutput <- tidy(modelhere, prob=c(0.9))
#quartz()
source("exp_muplot_brms90.R")
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-5, 5) , 5.5, 3.5) ## chloro
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-.15, .15) , .16, 3.5) ##toughness
muplotfx(modelhere, "", 8, 8, c(0,5), c(-35, 35) , 36.5, 3.5) ## thickness
fourwk <- bbandgs[(bbandgs$txchill=="01"),]
fourwktx <- bbandgs[(bbandgs$txchill=="11"),]
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(RColorBrewer)
# Set Working Directory
setwd("~/Documents/git/chillfreeze/analyses")
chillfrz <- read.csv("output/clean_dvr_traits.csv", header=TRUE)
rmspp <- c("NYSSYL", "FAGGRA")
chillfrz <- chillfrz[!(chillfrz$species%in%rmspp),]
### It would be good to know if the order of species changes
# in any of your treatments. You can use  the
# 'order' or 'rank' command in R I think to transform mean leafout to just
#a rank and try to plot how consistent this is across treatments.
bbandgs <- subset(chillfrz, select=c("budburst", "leafout", "tx", "chill", "budsetdoy", "species"))
bbandgs <- na.omit(bbandgs)
bbandgs$txchill <- paste0(bbandgs$tx, bbandgs$chill)
unique(bbandgs$txchill)
# "01"  "11"  "02"  "12"  "03"  "13"
fourwk <- bbandgs[(bbandgs$txchill=="01"),]
fourwktx <- bbandgs[(bbandgs$txchill=="11"),]
sixwk <- bbandgs[(bbandgs$txchill=="02"),]
sixwktx <- bbandgs[(bbandgs$txchill=="12"),]
eightwk <- bbandgs[(bbandgs$txchill=="03"),]
eightwktx <- bbandgs[(bbandgs$txchill=="13"),]
View(fourwk)
bbandgs$code <- reorder(bbandgs$species, bbandgs$lobytxchill)
bbandgs$species_tx <- paste(bbandgs$species, bbandgs$txchill, sep="_")
bbandgs$code <- reorder(bbandgs$species_tx, bbandgs$lobytxchill)
unique(bbandgs$lobytxchill)
### Okay, now we're going to try and rank them based on order by treatment by species
# Step 1)
bbandgs$lobytxchill <- ave(bbandgs$leafout, bbandgs$species, bbandgs$txchill)
bbandgs$species_tx <- paste(bbandgs$species, bbandgs$txchill, sep="_")
bbandgs$code <- reorder(bbandgs$species_tx, bbandgs$lobytxchill)
code
bbandgs$code
code_order <- as.data.frame(bbandgs$code, bbandgs$lobytxchill)
View(code_order)
View(bbandgs)
bbandgs$rank <- rank(bbandgs$species_tx, bbandgs$lobytxchill)
View(bbandgs)
bbandgs$rank <- rank(bbandgs$lobytxchill, bbandgs$species_tx)
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
rankbytx <- ggplot(bbandgs, aes(y=rank, x=txchill, col=species)) +
geom_line(aes(group=species)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Order/Rank of leafout") +
scale_color_manual(name="Species", values=cols,
labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_x_discrete(labels=c("01"="Control x 4wks Chill",
"11"="False Spring x 4wks Chill",
"02"="Control x 6wks Chill",
"12"="False Spring x 6wks Chill",
"03"="Control x 8wks Chill",
"13"="False Spring x 8wks Chill")) + coord_cartesian(expand = c(0,0))
quartz()
rankbytx
bbandgs$code_tx <- c("01", "11", "02", "12", "03", "13")
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(RColorBrewer)
# Set Working Directory
setwd("~/Documents/git/chillfreeze/analyses")
chillfrz <- read.csv("output/clean_dvr_traits.csv", header=TRUE)
rmspp <- c("NYSSYL", "FAGGRA")
chillfrz <- chillfrz[!(chillfrz$species%in%rmspp),]
### It would be good to know if the order of species changes
# in any of your treatments. You can use  the
# 'order' or 'rank' command in R I think to transform mean leafout to just
#a rank and try to plot how consistent this is across treatments.
bbandgs <- subset(chillfrz, select=c("budburst", "leafout", "tx", "chill", "budsetdoy", "species"))
bbandgs <- na.omit(bbandgs)
bbandgs$txchill <- paste0(bbandgs$chill, bbandgs$tx)
unique(bbandgs$txchill)
#### Let's look at overall averages and then do barplots... I think that will be the best first stab
bbandgs$lobyspp <- ave(bbandgs$leafout, bbandgs$species)
bbandgs$code <- reorder(bbandgs$species, bbandgs$lobyspp) ## Levels: SALPUR CORRAC BETPAP BETPOP ALNRUG VIBDEN SORAME ACESAC
### Okay, now we're going to try and rank them based on order by treatment by species
# Step 1)
bbandgs$lobytxchill <- ave(bbandgs$leafout, bbandgs$species, bbandgs$txchill)
bbandgs$species_tx <- paste(bbandgs$species, bbandgs$txchill, sep="_")
bbandgs$code <- reorder(bbandgs$species_tx, bbandgs$lobytxchill)
bbandgs$rank <- rank(bbandgs$lobytxchill, bbandgs$species_tx)
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
rankbytx <- ggplot(bbandgs, aes(y=rank, x=txchill, col=species)) +
geom_line(aes(group=species)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Order/Rank of leafout") +
scale_color_manual(name="Species", values=cols,
labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_x_discrete(labels=c("10"="Control x 4wks Chill",
"11"="False Spring x 4wks Chill",
"20"="Control x 6wks Chill",
"21"="False Spring x 6wks Chill",
"30"="Control x 8wks Chill",
"31"="False Spring x 8wks Chill")) + coord_cartesian(expand = c(0,0))
rankbytx
quartz()
rankbytx
rankbytx <- ggplot(bbandgs, aes(y=rank, x=txchill, col=species)) +
geom_line(aes(group=species)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0) +
xlab("") +
ylab("Order/Rank of leafout") +
scale_color_manual(name="Species", values=cols,
labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_x_discrete(labels=c("10"="Control x 4wks Chill",
"11"="False Spring x 4wks Chill",
"20"="Control x 6wks Chill",
"21"="False Spring x 6wks Chill",
"30"="Control x 8wks Chill",
"31"="False Spring x 8wks Chill")) + coord_cartesian(expand = c(0,0))
rankbytx
rankbytx <- ggplot(bbandgs, aes(y=rank, x=txchill, col=species)) +
geom_line(aes(group=species)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.text = element_text(face="italic")) +
xlab("") +
ylab("Order/Rank of leafout") +
scale_color_manual(name="Species", values=cols,
labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_x_discrete(labels=c("10"="Control x \n4wks Chill",
"11"="False Spring x \n4wks Chill",
"20"="Control x \n6wks Chill",
"21"="False Spring x \n6wks Chill",
"30"="Control x \n8wks Chill",
"31"="False Spring x \n8wks Chill")) + coord_cartesian(expand = c(0,0))
rankbytx
minrankbytx <- ggplot(bbandgs, aes(y=minrank, x=txchill, col=species)) +
geom_line(aes(group=species)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.text = element_text(face="italic")) +
xlab("") +
ylab("Order/Rank of leafout") +
scale_color_manual(name="Species", values=cols,
labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_x_discrete(labels=c("10"="Control x \n4wks Chill",
"11"="False Spring x \n4wks Chill",
"20"="Control x \n6wks Chill",
"21"="False Spring x \n6wks Chill",
"30"="Control x \n8wks Chill",
"31"="False Spring x \n8wks Chill")) + coord_cartesian(expand = c(0,0))
bbandgs$minrank <- min_rank(bbandgs$lobytxchill, bbandgs$species_tx) ## try to add a window...?
bbandgs$minrank <- min_rank(bbandgs$rank) ## try to add a window...?
minrankbytx <- ggplot(bbandgs, aes(y=minrank, x=txchill, col=species)) +
geom_line(aes(group=species)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.text = element_text(face="italic")) +
xlab("") +
ylab("Order/Rank of leafout") +
scale_color_manual(name="Species", values=cols,
labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_x_discrete(labels=c("10"="Control x \n4wks Chill",
"11"="False Spring x \n4wks Chill",
"20"="Control x \n6wks Chill",
"21"="False Spring x \n6wks Chill",
"30"="Control x \n8wks Chill",
"31"="False Spring x \n8wks Chill")) + coord_cartesian(expand = c(0,0))
quartz()
minrankbytx
#bbandgs$rank <- rank(bbandgs$lobytxchill, bbandgs$species_tx)
bbandgs$minrank <- min_rank(bbandgs$lobytxchill) ## try to add a window...?
minrankbytx <- ggplot(bbandgs, aes(y=minrank, x=txchill, col=species)) +
geom_line(aes(group=species)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.text = element_text(face="italic")) +
xlab("") +
ylab("Order/Rank of leafout") +
scale_color_manual(name="Species", values=cols,
labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_x_discrete(labels=c("10"="Control x \n4wks Chill",
"11"="False Spring x \n4wks Chill",
"20"="Control x \n6wks Chill",
"21"="False Spring x \n6wks Chill",
"30"="Control x \n8wks Chill",
"31"="False Spring x \n8wks Chill")) + coord_cartesian(expand = c(0,0))
minrankbytx
bbandgs$minrank
bbandgs$distofrank <- cume_dist(bbandgs$lobytxchill)
bbandgsquant <- group_by(bbandgs, quartile = ntile(bbandgs$lobytxchill, 8))
bbandgsquant
bbandgsquant <- group_by(bbandgs, quartile = ntile(bbandgs$rank, 8))
View(bbandgsquant)
bbandgsquant <- group_by(bbandgs, quartile = ntile(bbandgs$lobytxchill, 8))
sort(unique(bbandgs$rank))
# Step 1) For budset now
bbandgs$bsetbytxchill <- ave(bbandgs$budsetdoy, bbandgs$species, bbandgs$txchill)
bbandgs$species_tx <- paste(bbandgs$species, bbandgs$txchill, sep="_")
bbandgs$codebset <- reorder(bbandgs$species_tx, bbandgs$lobytxchill)
bbandgs$rankbset <- rank(bbandgs$bsetbytxchill, bbandgs$species_tx)
# Step 2) Plot using this rank
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
rankbytx <- ggplot(bbandgs, aes(y=rankbset, x=txchill, col=species)) +
geom_line(aes(group=species)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.key = element_rect(colour = "transparent", fill = "white"),
legend.text = element_text(face="italic")) +
xlab("") +
ylab("Order/Rank of leafout") +
scale_color_manual(name="Species", values=cols,
labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_x_discrete(labels=c("10"="Control x \n4wks Chill",
"11"="False Spring x \n4wks Chill",
"20"="Control x \n6wks Chill",
"21"="False Spring x \n6wks Chill",
"30"="Control x \n8wks Chill",
"31"="False Spring x \n8wks Chill")) + coord_cartesian(expand = c(0,0))
quartz()
rankbytx
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
source('source/stan_utility.R')
#chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
#chill.stan <- read.csv("output/fakedata_height.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_traits.csv")
chill.stan <- chill.stan[!is.na(chill.stan$dvr),]
rmspp <- c("FAGGRA", "NYSSYL")
chill.stan <- chill.stan[!(chill.stan$species%in%rmspp),]
get_prior(leafout ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan)
leafout.mod <- brm(leafout ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan, iter=4000, warmup=2500,
prior = prior(normal(50, 15), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
leafout.mod
get_prior(budsetdoy ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan)
budsetdoy.mod <- brm(budsetdoy ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan, iter=4000, warmup=2500,
prior = prior(normal(330, 50), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
save(leafout.mod, file="~/Documents/git/chillfreeze/analyses/stan/leafout_brms.Rdata")
budsetdoy.mod
leafout.mod
save(budsetdoy.mod, file="~/Documents/git/chillfreeze/analyses/stan/budset_brms.Rdata")
