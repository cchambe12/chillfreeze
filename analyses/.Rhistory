gslength.mod <- brm(gslength ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.gs, iter=4000, warmup=2500,
prior_intercept = normal(180, 40),
control=list(max_treedepth=15, adapt_delta=0.99))
gslength.mod <- stan_glmer(gslength ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.gs, iter=4000, warmup=2500,
prior_intercept = normal(180, 40),
control=list(max_treedepth=15, adapt_delta=0.99))
save(gslength.mod, file="~/Documents/git/chillfreeze/analyses/stan/gslength_brms.Rdata")
chill.stan.meri <- chill.stan[!is.na(chill.stan$meristem),]
meri.mod <- stan_glmer(meristem ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.meri, family=binomial(link="logit"), iter=4000, warmup=2500,
prior_intercept=normal(0,1),
control=list(max_treedepth=15, adapt_delta=0.99))
save(meri.mod, file="~/Documents/git/chillfreeze/analyses/stan/meristem_brms.Rdata")
chill.stan.th <- chill.stan[!is.na(chill.stan$thick),]
thickness.mod <- stan_glmer(thick ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.th, iter=4000, warmup=2500,
prior_intercept = normal(0, 1),
control=list(max_treedepth=15, adapt_delta=0.99))
save(thickness.mod, file="~/Documents/git/chillfreeze/analyses/stan/thickness_brms.Rdata")
chill.stan.tough <- chill.stan[!is.na(chill.stan$tough),]
toughness.mod <- stan_glmer(tough ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.tough, iter=4000, warmup=2500,
prior_intercept = normal(0, 1),
control=list(max_treedepth=15, adapt_delta=0.99))
launch_shinystan(toughness.mod)
save(toughness.mod, file="~/Documents/git/chillfreeze/analyses/stan/toughness_brms.Rdata")
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(rstan)
library(dplyr)
library(broom)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
source('source/stan_utility.R')
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
source('source/stan_utility.R')
#chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
#chill.stan <- read.csv("output/fakedata_height.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_traits.csv")
chill.stan$roottoshoot <- chill.stan$roots/chill.stan$shoots
chill.stan.rs <- chill.stan[!is.na(chill.stan$roottoshoot),]
roottoshoot.mod <- stan_glmer(roottoshoot ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.rs, iter=4000, warmup=2500,
prior_intercept = cauchy(0, 15),
control=list(max_treedepth=15, adapt_delta=0.99))
save(roottoshoot.mod, file="~/Documents/git/chillfreeze/analyses/stan/roottoshoot_brms.Rdata")
chill.stan$totbiomass <- chill.stan$roots + chill.stan$shoots
chill.stan.tb <- chill.stan[!is.na(chill.stan$totbiomass),]
totbiomass.mod <- stan_glmer(totbiomass ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.tb, iter=4000, warmup=2500,
prior_intercept=normal(40, 15),
control=list(max_treedepth=15, adapt_delta=0.99))
save(totbiomass.mod, file="~/Documents/git/chillfreeze/analyses/stan/totbiomass_brms.Rdata")
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(rstan)
library(dplyr)
library(broom)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
## load the model
load("stan/gslength_brms.Rda")
## load the model
load("stan/gslength_brms.Rdata")
#chill.stan <- read.csv("output/clean_dvr_drought.csv", header=TRUE)
#chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_traits.csv")
chill.stan$species.name <- NA
chill.stan$species.name <- ifelse(chill.stan$species=="ACESAC", "Acer saccharinum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="ALNRUG", "Alnus rugosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPAP", "Betula papyrifera", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPOP", "Betula populifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="CORRAC", "Cornus racemosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SALPUR", "Salix purpurea", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SORAME", "Sorbus americana", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="VIBDEN", "Viburnum dentatum", chill.stan$species.name)
#### Now for mu plots based of bb_analysis/models_stan_plotting.R ###
figpath <- "figures"
figpathmore <- "gslength_brms" ### change based on model
source("exp_muplot_brms.R")
cols <- adjustcolor("indianred3", alpha.f = 0.3)
my.pal <- rep(brewer.pal(n = 10, name = "Paired"), 8)
# display.brewer.all()
alphahere = 0.4
#mu <- expression(mu)
#xlab <- expression(paste("Model estimate of change in leaf thickness (", mu, "m)", sep="")) ## change based on model
#xlab <- "Model estimate of change in leaf toughness (N)"
#xlab <- "Model estimate of change in rate of leafout (days)"
#xlab <- "Model estimate of change in growth (cm)"
#xlab <- "Model estimate of change in shoot apical meristem damage"
xlab <- "Model estimate of change in growing season length (days)"
spp <- unique(chill.stan$species)
modelhere <- totbiomass.mod
tx <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 2] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select(mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx", "[", i, "]", sep="")
}
tx$parameter<-new.names
chill1 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 3] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill1", "[", i, "]", sep="")
}
chill1$parameter<-new.names
mod.ranef<-full_join(tx, chill1)
chill2 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 4] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill2", "[", i, "]", sep="")
}
chill2$parameter<-new.names
mod.ranef <- full_join(mod.ranef, chill2)
txchill1 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 5] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill1", "[", i, "]", sep="")
}
txchill1$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill1)
txchill2 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 6] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill2", "[", i, "]", sep="")
}
txchill2$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill2)
modoutput <- tidy(modelhere, prob=c(0.5))
modelhere <- gslength.mod
tx <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 2] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select(mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx", "[", i, "]", sep="")
}
tx$parameter<-new.names
chill1 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 3] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill1", "[", i, "]", sep="")
}
chill1$parameter<-new.names
mod.ranef<-full_join(tx, chill1)
chill2 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 4] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill2", "[", i, "]", sep="")
}
chill2$parameter<-new.names
mod.ranef <- full_join(mod.ranef, chill2)
txchill1 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 5] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill1", "[", i, "]", sep="")
}
txchill1$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill1)
txchill2 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 6] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill2", "[", i, "]", sep="")
}
txchill2$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill2)
modoutput <- tidy(modelhere, prob=c(0.5))
#quartz()
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-22, 22) , 23.5, 3.5)
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-15, 15) , 16.5, 3.5)
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-.15, .15) , .16, 3.5)
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-0.4, 0.4) , .42, 3.5)
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-8, 8) , 9, 3.5)
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-1, 1) , 1.1, 3.5)
coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 2] %>%
as.data.frame()
coef(modelhere, prob=c(0.25, 0.75))$species
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
source('source/stan_utility.R')
#chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
#chill.stan <- read.csv("output/fakedata_height.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_traits.csv")
#chill.stan <- read.csv("output/clean_dvr_drought.csv")
chill.stan.gs <- chill.stan[!is.na(chill.stan$gslength),]
gslength.mod <- brm(gslength ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.gs, iter=4000, warmup=2500,
prior = normal(180, 40),
control=list(max_treedepth=15, adapt_delta=0.99))
gslength.mod <- brm(gslength ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.gs, iter=4000, warmup=2500,
prior = prior(normal(180, 40), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
gslength.mod
## load the model
load("stan/gslength_brms.Rdata")
gslength.mod
save(gslength.mod, file="~/Documents/git/chillfreeze/analyses/stan/gslength_brms.Rdata")
chill.stan.ht <- chill.stan[!is.na(chill.stan$ht.final),]
chill.stan.ht$finaldiff <- chill.stan.ht$ht.final - chill.stan.ht$lo.ht
get_prior(finaldiff ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.ht)
htdiff.mod <- brm(finaldiff ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.ht, iter=4000, warmup=2500,
control=list(max_treedepth=15, adapt_delta=0.99),
prior = prior(normal(60, 30), class=Intercept))
save(htdiff.mod, file="~/Documents/git/chillfreeze/analyses/stan/htdiff_brms.Rdata")
chill.stan.rt <- chill.stan[!is.na(chill.stan$roots),]
get_prior(roots ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.rt)
roots.mod <- brm(roots ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.rt, iter=4000, warmup=2500,
prior = prior(normal(30, 15), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
save(roots.mod, file="~/Documents/git/chillfreeze/analyses/stan/roots_brms.Rdata")
chill.stan.sh <- chill.stan[!is.na(chill.stan$shoots),]
shoots.mod <- brm(shoots ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.sh, iter=4000, warmup=2500,
prior = prior(normal(30, 15), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
save(shoots.mod, file="~/Documents/git/chillfreeze/analyses/stan/shoots_brms.Rdata")
chill.stan$roottoshoot <- chill.stan$roots/chill.stan$shoots
chill.stan.rs <- chill.stan[!is.na(chill.stan$roottoshoot),]
get_prior(roottoshoot ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species), data=chill.stan.rs)
roottoshoot.mod <- brm(roottoshoot ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.rs, iter=4000, warmup=2500,
prior = prior(cauchy(0, 15), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
save(roottoshoot.mod, file="~/Documents/git/chillfreeze/analyses/stan/roottoshoot_brms.Rdata")
chill.stan$totbiomass <- chill.stan$roots + chill.stan$shoots
chill.stan.tb <- chill.stan[!is.na(chill.stan$totbiomass),]
totbiomass.mod <- brm(totbiomass ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.tb, iter=4000, warmup=2500,
prior = prior(normal(40, 15), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
save(totbiomass.mod, file="~/Documents/git/chillfreeze/analyses/stan/totbiomass_brms.Rdata")
chill.stan.meri <- chill.stan[!is.na(chill.stan$meristem),]
meri.mod <- brm(meristem ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.meri, family=binomial(link="logit"), iter=4000, warmup=2500,
prior = prior(normal(0, 1), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
save(meri.mod, file="~/Documents/git/chillfreeze/analyses/stan/meristem_brms.Rdata")
chill.stan.th <- chill.stan[!is.na(chill.stan$thick),]
thickness.mod <- brm(thick ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.th, iter=4000, warmup=2500,
prior = prior(normal(0, 1), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
save(thickness.mod, file="~/Documents/git/chillfreeze/analyses/stan/thickness_brms.Rdata")
chill.stan.tough <- chill.stan[!is.na(chill.stan$tough),]
toughness.mod <- stan_glmer(tough ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.tough, iter=4000, warmup=2500,
prior = prior(normal(0, 1), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
View(chill.stan.tough)
toughness.mod <- stan_glmer(tough ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.tough, iter=4000, warmup=2500,
prior = prior(normal(0, 1)),
control=list(max_treedepth=15, adapt_delta=0.99))
toughness.mod <- stan_glmer(tough ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.tough, iter=4000, warmup=2500,
control=list(max_treedepth=15, adapt_delta=0.99))
save(toughness.mod, file="~/Documents/git/chillfreeze/analyses/stan/toughness_brms.Rdata")
# housekeeping
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(rstan)
library(dplyr)
library(broom)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
## load the model
load("stan/gslength_brms.Rdata")
#chill.stan <- read.csv("output/clean_dvr_drought.csv", header=TRUE)
#chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_traits.csv")
chill.stan$species.name <- NA
chill.stan$species.name <- ifelse(chill.stan$species=="ACESAC", "Acer saccharinum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="ALNRUG", "Alnus rugosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPAP", "Betula papyrifera", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPOP", "Betula populifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="CORRAC", "Cornus racemosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SALPUR", "Salix purpurea", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SORAME", "Sorbus americana", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="VIBDEN", "Viburnum dentatum", chill.stan$species.name)
#### Now for mu plots based of bb_analysis/models_stan_plotting.R ###
figpath <- "figures"
figpathmore <- "gslength_brms" ### change based on model
source("exp_muplot_brms.R")
cols <- adjustcolor("indianred3", alpha.f = 0.3)
my.pal <- rep(brewer.pal(n = 10, name = "Paired"), 8)
# display.brewer.all()
alphahere = 0.4
#mu <- expression(mu)
#xlab <- expression(paste("Model estimate of change in leaf thickness (", mu, "m)", sep="")) ## change based on model
#xlab <- "Model estimate of change in leaf toughness (N)"
#xlab <- "Model estimate of change in rate of leafout (days)"
#xlab <- "Model estimate of change in growth (cm)"
#xlab <- "Model estimate of change in shoot apical meristem damage"
xlab <- "Model estimate of change in growing season length"
spp <- unique(chill.stan$species)
modelhere <- gslength.mod
tx <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 2] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select(mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx", "[", i, "]", sep="")
}
tx$parameter<-new.names
chill1 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 3] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill1", "[", i, "]", sep="")
}
chill1$parameter<-new.names
mod.ranef<-full_join(tx, chill1)
chill2 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 4] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill2", "[", i, "]", sep="")
}
chill2$parameter<-new.names
mod.ranef <- full_join(mod.ranef, chill2)
txchill1 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 5] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill1", "[", i, "]", sep="")
}
txchill1$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill1)
txchill2 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 6] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill2", "[", i, "]", sep="")
}
txchill2$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill2)
modoutput <- tidy(modelhere, prob=c(0.5))
#quartz()
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-22, 22) , 23.5, 3.5)
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-15, 15) , 16.5, 3.5)
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-.15, .15) , .16, 3.5)
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-0.4, 0.4) , .42, 3.5)
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-8, 8) , 9, 3.5)
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-1, 1) , 1.1, 3.5)
#quartz()
muplotfx(modelhere, "", 8, 8, c(0,5), c(-22, 22) , 23.5, 3.5)
View(gslength.mod)
gslength.mod
gslength.mod <- brm(gslength ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.gs, iter=4000, warmup=2500,
prior = prior(normal(180, 40), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
source('source/stan_utility.R')
#chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
#chill.stan <- read.csv("output/fakedata_height.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_traits.csv")
#chill.stan <- read.csv("output/clean_dvr_drought.csv")
chill.stan.gs <- chill.stan[!is.na(chill.stan$gslength),]
gslength.mod <- brm(gslength ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2 | species),
data=chill.stan.gs, iter=4000, warmup=2500,
prior = prior(normal(180, 40), class=Intercept),
control=list(max_treedepth=15, adapt_delta=0.99))
save(gslength.mod, file="~/Documents/git/chillfreeze/analyses/stan/gslength_brms.Rdata")
