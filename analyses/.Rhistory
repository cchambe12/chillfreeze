gslow.time <- gs[(gs$Time_after_excision[i==gs$uniqueid]),][gs.low[i==gs$uniqueid]]
(gs$Time_after_excision[i==gs$uniqueid])
(gs$Time_after_excision[i==gs$uniqueid]),[gs.low[i==gs$uniqueid]]
(gs$Time_after_excision[i==gs$uniqueid])[gs.low[i==gs$uniqueid]]
(gs$Time_after_excision[i==gs$uniqueid])[gs.low]
gslow.time <- (gs$Time_after_excision[i==gs$uniqueid])[gs.low]
gslow.time
gs <- read.csv("~/Downloads/gslope.csv")
gs <- read.csv("~/Downloads/gslope.csv")
gs <- read.csv("~/Downloads/gslope.csv")
gs$uniqueid <- paste(gs$Date, gs$Species, gs$PlantID, gs$LeafID, sep="_")
gs$gslow <- NA
for(i in c(unique(gs$uniqueid))) {
gs.low <- which(gs$gsw[i==gs$uniqueid] < gs$lw[i==gs$uniqueid])[1]
gslow.time <- (gs$Time_after_excision[i==gs$uniqueid])[gs.low]
gs$gslow[i==gs$uniqueid] <- gslow.time
}
gs.subby <- gs[(gs$Time_after_excision>=gs$gslow && gs$Time_after_excision<=gs$gslow+100),]
View(gs.subby)
gs.subby <- gs[(gs$Time_after_excision>=gs$gslow & gs$Time_after_excision<=gs$gslow+100),]
gs.subby <- gs[(gs$Time_after_excision>=gs$gslow & gs$Time_after_excision<=gs$gslow+100),]
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[i==gs.subby$uniqueid])
i=1
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
i=8/16/2018_Schisandra_chinensis_409-89*B_10
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gsw.mod
summary(gsw.mod)$coef[1,2]
summary(gsw.mod)$coef[2,1]
for(i in c(unique(gs.subby$uniqueid))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gs.subby <- gs[(gs$Time_after_excision>=gs$gslow & gs$Time_after_excision<=gs$gslow+100),]
gs.subby$slope <- NA
for(i in c(unique(gs.subby$uniqueid))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- ifelse(gs.subby$gslow==0, NA, lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),]))
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gs.subby$slope <- NA
gsw.mod <- ifelse(gs.subby$gslow[i==gs.subby$uniqueid]==0, NA, lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),]))
gs.subby$slope <- NA
for(i in c(unique(gs.subby$uniqueid))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- ifelse(gs.subby$gslow[i==gs.subby$uniqueid]==0, NA, lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),]))
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gs.subby$slope <- NA
for(i in c(unique(gs.subby$uniqueid))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- ifelse(gs.subby$gslow[i==gs.subby$uniqueid]==0, 0,
lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),]))
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gsw.mod <- ifelse(gs.subby$gslow[i==gs.subby$uniqueid]==0, NA,
lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),]))
gs.subby$slope[i==gs.subby$uniqueid] <- ifelse(gs.subby$gslow[i==gs.subby$uniqueid]==0, NA,
summary(gsw.mod)$coef[2,1])
gs.subby$slope[i==gs.subby$uniqueid] <- ifelse(is.na(gs.subby$slope[i==gs.subby$uniqueid]), NA,
summary(gsw.mod)$coef[2,1])
gsw.mod <- ifelse(gs.subby$gslow[i==gs.subby$uniqueid]==0, 0,
lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),]))
gs.subby$slope[i==gs.subby$uniqueid] <- ifelse(is.na(gs.subby$slope[i==gs.subby$uniqueid]), 0,
summary(gsw.mod)$coef[2,1])
gsw.mod <- ifelse(gs.subby$gslow[i==gs.subby$uniqueid]==0, 0,
lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),]))
gs.subby$slope[i==gs.subby$uniqueid] <- ifelse(gs.subby$slope[i==gs.subby$uniqueid]==0, 0,
summary(gsw.mod)$coef[2,1])
gs.subby$slope <- NA
for(i in c(unique(gs.subby$uniqueid))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- ifelse(gs.subby$gslow[i==gs.subby$uniqueid]==0, 0,
lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),]))
gs.subby$slope[i==gs.subby$uniqueid] <- ifelse(gs.subby$slope[i==gs.subby$uniqueid]==0, 0,
summary(gsw.mod)$coef[2,1])
}
gsw.mod <- ifelse(gs.subby$gslow[i==gs.subby$uniqueid]==0, NA,
lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),]))
gsw.mod
gs.subby$slope[i==gs.subby$uniqueid] <- ifelse(is.na(gsw.mod), 0,
summary(gsw.mod)$coef[2,1])
c(unique(gs.subby$uniqueid[gs.subby$gslow>0]))
gs.subby$slope <- NA
for(i in c(unique(gs.subby$uniqueid[gs.subby$gslow>0]))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1])
}
gs.subby$slope <- NA
for(i in c(unique(gs.subby$uniqueid[gs.subby$gslow>0]))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
baddies <- c(NA, 0)
for(i in c(unique(gs.subby$uniqueid[gs.subby$gslow%in%baddies]))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gs.subby <- gs.subby[!is.na(gs.subby$Date),]
gs.subby$slope <- NA
baddies <- c(NA, 0)
for(i in c(unique(gs.subby$uniqueid[gs.subby$gslow%in%baddies]))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gsw.mod
i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gsw.mod
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
gs.subby$slope
summary(gsw.mod)$coef[2,1]
gs.subby$slope[i==gs.subby$uniqueid]
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
gs.subby$slope
for(i in c(unique(gs.subby$uniqueid[gs.subby$gslow%in%baddies]))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_10"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
i="8/16/2018_Schisandra_chinensis_409-89*B_20"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
gs.subby$slope
c(unique(gs.subby$uniqueid[!gs.subby$gslow%in%baddies]))
for(i in c(unique(gs.subby$uniqueid[!gs.subby$gslow%in%baddies]))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_20"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gs.subby$slope <- NA
baddies <- c(NA)
for(i in c(unique(gs.subby$uniqueid[!is.na(gs.subby$gslow)]))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_20"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
!is.na(gs.subby$gslow)
gs.subby$slope <- NA
for(i in c(unique(gs.subby$uniqueid))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_20"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gs.subby$slope <- NA
baddies <- c(NA, 0)
for(i in c(unique(gs.subby$uniqueid[!gs.subby$gslow%in%baddies]))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_20"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gs.subby$slope <- NA
baddies <- c(NA)
for(i in c(unique(gs.subby$uniqueid[!gs.subby$gslow%in%baddies]))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_20"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gs.subby$slope <- NA
baddies <- c(NA, "8/23/2018_Lindera_obtusiloba_1255-83*A_13")
for(i in c(unique(gs.subby$uniqueid[!gs.subby$gslow%in%baddies]))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_20"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby[(i==gs.subby$uniqueid),])
gs.subby$slope[i==gs.subby$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
gs.subby$ncount <- ave(gs.subby$uniqueid, FUN=length)
gs.subby$ncount <- ave(gs.subby$gslow, gs.subby$uniqueid, FUN=length)
range(gs.subby$ncount)
gs.subby <- within( gs.subby, {num <- ave(gslow, uniqueid, FUN=length)})
gs.subby <- gs[(gs$Time_after_excision>=gs$gslow & gs$Time_after_excision<=gs$gslow+100),]
gs.subby <- gs.subby[!is.na(gs.subby$Date),]
gs.subby <- within( gs.subby, {ncount <- ave(gslow, uniqueid, FUN=length)})
gs.subby.goodies <- gs.subby[(gs.subby$ncount==6),]
gs.subby.goodies$slope <- NA
for(i in c(unique(gs.subby.goodies$uniqueid))) { #i="8/16/2018_Schisandra_chinensis_409-89*B_20"
gsw.mod <- lm(gsw ~ Time_after_excision, data=gs.subby.goodies[(i==gs.subby.goodies$uniqueid),])
gs.subby.goodies$slope[i==gs.subby.goodies$uniqueid] <- summary(gsw.mod)$coef[2,1]
}
View(gs.subby.goodies)
View(gs.subby.goodies)
gs.subby.baddies <- gs.subby[(gs.subby$ncount!=6),]
View(gs.subby.baddies)
length(unique(gs.subby.baddies$uniqueid))
#load models and data to report numbers of things
options(stringsAsFactors = FALSE)
library(brms)
## Set Working Directory
setwd("/Users/CatherineChamberlain/Documents/git/chillfreeze/analyses/")
load("stan/htfinal_brms.Rdata") ## need to download to compile
chillfrz <- read.csv("output/clean_dvr_traits.csv", header=TRUE)
rmspp <- c("NYSSYL", "FAGGRA")
chillfrz <- chillfrz[!(chillfrz$species%in%rmspp),]
httx<-round(mean(fixef(htdiff.mod, pars="tx", summary=FALSE)), digits=2) ### 5.06
httxsd<-round(mean(fixef(htdiff.mod, pars="tx")[2]), digits=2) # 4.38
#httxsd <- httxsd[2] - httxsd[1]
htchill1<-round(mean(fixef(htdiff.mod, pars="chill1", summary=FALSE)), digits=2) ### 2.81
htchill1sd<-round(mean(fixef(htdiff.mod, pars="chill1")[2]), digits=2) # 1.55
#htchill1sd<- htchill1sd[2] - htchill1sd[1]
htchill2<-round(mean(fixef(htdiff.mod, pars="chill2", summary=FALSE)), digits=2) ### 1.32
htchill2sd<-round(mean(fixef(htdiff.mod, pars="chill2")[2]), digits=2) # 1.21
#htchill2sd<- htchill2sd[2] - htchill2sd[1]
httxchill1<-round(mean(fixef(htdiff.mod, pars="tx:chill1", summary=FALSE)), digits=2)
httxchill1sd<-round(mean(fixef(htdiff.mod, pars="tx:chill1")[2]), digits=2) # 1.48
#httxchill1sd<- httxchill1sd[2] - httxchill1sd[1]
httxchill1 <- round(httx + htchill1 + httxchill1, digits=2) # 0.36
httxchill2<-round(mean(fixef(htdiff.mod, pars="tx:chill2", summary=FALSE)), digits=2)
httxchill2sd<-round(mean(fixef(htdiff.mod, pars="tx:chill2")[2]), digits=2) # 1.46
#httxchill2sd<- httxchill2sd[2] - httxchill2sd[1]
httxchill2 <- httx + htchill2 + httxchill2 # 0.68
httxchill2
httxchill2sd
httxchill1
httxchill1sd
htchill2
htchill2sd
htchill1
htchill1sd
httx
httxsd
totbiomasstx
### Total biomass Model - TX DECREASES BIOMASS BUT CHILLING CAN COMPENSATE!!!
totbiomasstx<-round(mean(fixef(totbiomass.mod, pars="tx", summary=FALSE)), digits=2) ### -3.45
totbiomasstxsd<-round(mean(fixef(totbiomass.mod, pars="tx")[2]), digits=2)  # 2.78
#totbiomasstxsd <- totbiomasstxsd[2] - totbiomasstxsd[1]
totbiomasschill1<-round(mean(fixef(totbiomass.mod, pars="chill1", summary=FALSE)), digits=2) # 0.38
totbiomasschill1sd<-round(mean(fixef(totbiomass.mod, pars="chill1")[2]), digits=2) # 2.91
#totbiomasschill1sd <- totbiomasschill1sd[2] - totbiomasschill1sd[1]
totbiomasschill2<-round(mean(fixef(totbiomass.mod, pars="chill2", summary=FALSE)), digits=2) # 2.59
totbiomasschill2sd<-round(mean(fixef(totbiomass.mod, pars="chill2")[2]), digits=2) # 3.04
#totbiomasschill2sd <- totbiomasschill2sd[2] - totbiomasschill2sd[1]
totbiomasstxchill1<-round(mean(fixef(totbiomass.mod, pars="tx:chill1", summary=FALSE)), digits=2)
totbiomasstxchill1sd<-round(mean(fixef(totbiomass.mod, pars="tx:chill1")[2]), digits=2) #  4.04
#totbiomasstxchill1sd <- totbiomasstxchill1sd[2] - totbiomasstxchill1sd[1]
totbiomasstxchill1 <- totbiomasstx + totbiomasschill1 + totbiomasstxchill1 # -3.62
load("stan/totbiomass_brms.Rdata")
### Ht final Model - Not intersting
load("stan/htfinal_brms.Rdata")
httx<-round(mean(fixef(htdiff.mod, pars="tx", summary=FALSE)), digits=2) ### 5.06
httxsd<-round(mean(fixef(htdiff.mod, pars="tx")[2]), digits=2) # 4.38
#httxsd <- httxsd[2] - httxsd[1]
htchill1<-round(mean(fixef(htdiff.mod, pars="chill1", summary=FALSE)), digits=2) ### 2.81
htchill1sd<-round(mean(fixef(htdiff.mod, pars="chill1")[2]), digits=2) # 1.55
#htchill1sd<- htchill1sd[2] - htchill1sd[1]
htchill2<-round(mean(fixef(htdiff.mod, pars="chill2", summary=FALSE)), digits=2) ### 1.32
htchill2sd<-round(mean(fixef(htdiff.mod, pars="chill2")[2]), digits=2) # 1.21
#htchill2sd<- htchill2sd[2] - htchill2sd[1]
httxchill1<-round(mean(fixef(htdiff.mod, pars="tx:chill1", summary=FALSE)), digits=2)
httxchill1sd<-round(mean(fixef(htdiff.mod, pars="tx:chill1")[2]), digits=2) # 1.48
#httxchill1sd<- httxchill1sd[2] - httxchill1sd[1]
httxchill1 <- round(httx + htchill1 + httxchill1, digits=2) # 0.36
httxchill2<-round(mean(fixef(htdiff.mod, pars="tx:chill2", summary=FALSE)), digits=2)
httxchill2sd<-round(mean(fixef(htdiff.mod, pars="tx:chill2")[2]), digits=2) # 1.46
#httxchill2sd<- httxchill2sd[2] - httxchill2sd[1]
httxchill2 <- httx + htchill2 + httxchill2 # 0.68
### Total biomass Model - TX DECREASES BIOMASS BUT CHILLING CAN COMPENSATE!!!
totbiomasstx<-round(mean(fixef(totbiomass.mod, pars="tx", summary=FALSE)), digits=2) ### -3.45
totbiomasstxsd<-round(mean(fixef(totbiomass.mod, pars="tx")[2]), digits=2)  # 2.78
#totbiomasstxsd <- totbiomasstxsd[2] - totbiomasstxsd[1]
totbiomasschill1<-round(mean(fixef(totbiomass.mod, pars="chill1", summary=FALSE)), digits=2) # 0.38
totbiomasschill1sd<-round(mean(fixef(totbiomass.mod, pars="chill1")[2]), digits=2) # 2.91
#totbiomasschill1sd <- totbiomasschill1sd[2] - totbiomasschill1sd[1]
totbiomasschill2<-round(mean(fixef(totbiomass.mod, pars="chill2", summary=FALSE)), digits=2) # 2.59
totbiomasschill2sd<-round(mean(fixef(totbiomass.mod, pars="chill2")[2]), digits=2) # 3.04
#totbiomasschill2sd <- totbiomasschill2sd[2] - totbiomasschill2sd[1]
totbiomasstxchill1<-round(mean(fixef(totbiomass.mod, pars="tx:chill1", summary=FALSE)), digits=2)
totbiomasstxchill1sd<-round(mean(fixef(totbiomass.mod, pars="tx:chill1")[2]), digits=2) #  4.04
#totbiomasstxchill1sd <- totbiomasstxchill1sd[2] - totbiomasstxchill1sd[1]
totbiomasstxchill1 <- totbiomasstx + totbiomasschill1 + totbiomasstxchill1 # -3.62
totbiomasstxchill2<-round(mean(fixef(totbiomass.mod, pars="tx:chill2", summary=FALSE)), digits=2)
totbiomasstxchill2sd<-round(mean(fixef(totbiomass.mod, pars="tx:chill2")[2]), digits=2) #  3.97
#totbiomasstxchill2sd <- totbiomasstxchill2sd[2] - totbiomasstxchill2sd[1]
totbiomasstxchill2 <- totbiomasstx + totbiomasschill2 + totbiomasstxchill2 # 2.88
totbiomasstxchill2
totbiomasstxchill2sd
totbiomasstxchill2
totbiomasstxchill1
totbiomasstxchill1sd
totbiomasschill2
totbiomasschill2sd
totbiomasschill1
totbiomasschill1sd
totbiomasschill1
totbiomasschill1sd
totbiomasschill2
totbiomasschill2sd
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(rstan)
library(dplyr)
library(broom)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
load("stan/htfinal_brms.Rdata")
chill.stan <- read.csv("output/clean_dvr_traits.csv")
chill.stan$species.name <- NA
chill.stan$species.name <- ifelse(chill.stan$species=="ACESAC", "Acer saccharinum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="ALNRUG", "Alnus rugosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPAP", "Betula papyrifera", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPOP", "Betula populifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="CORRAC", "Cornus racemosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SALPUR", "Salix purpurea", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SORAME", "Sorbus americana", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="VIBDEN", "Viburnum dentatum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="FAGGRA", "Fagus grandifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="NYSSYL", "Nyssa sylvatica", chill.stan$species.name)
rmspp <- c("FAGGRA", "NYSSYL")
chill.stan <- chill.stan[!(chill.stan$species%in%rmspp),]
#### Now for mu plots based of bb_analysis/models_stan_plotting.R ###
figpath <- "figures"
figpathmore <- "htfinal90_brms" ### change based on model
cols <- adjustcolor("indianred3", alpha.f = 0.3)
my.pal <- rep(brewer.pal(n = 10, name = "Paired"), 8)
# display.brewer.all()
alphahere = 0.4
#xlab <- "Model estimate of change in \nduration of vegetative risk (days)"
xlab <- "Model estimate of change in growing season length (days)"
#xlab <- "Model estimate of change in shoot growth (cm)"
xlab <- "Model estimate of change in shoot growth per day (mm/day)"
if(FALSE){
#xlab <- "Model estimate of change in belowground biomass (g)"
#xlab <- "Model estimate of change in aboveground biomass (g)"
}
spp <- unique(chill.stan$species)
modelhere <- htdiff.mod
tx <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 2] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select(mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx", "[", i, "]", sep="")
}
tx$parameter<-new.names
chill1 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 3] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill1", "[", i, "]", sep="")
}
chill1$parameter<-new.names
mod.ranef<-full_join(tx, chill1)
chill2 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 4] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill2", "[", i, "]", sep="")
}
chill2$parameter<-new.names
mod.ranef <- full_join(mod.ranef, chill2)
txchill1 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 5] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill1", "[", i, "]", sep="")
}
txchill1$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill1)
txchill2 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 6] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill2", "[", i, "]", sep="")
}
txchill2$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill2)
modoutput <- tidy(modelhere, prob=c(0.5))
#quartz()
source("exp_muplot_brms90.R")
muplotfx(modelhere, "", 8, 8, c(0,5), c(-22, 22) , 23.5, 3.5) ## ht final
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(rstan)
library(dplyr)
library(broom)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
## load the model
#load("stan/dvr_brms.Rdata")
#load("stan/gslengthlo_brms_adjusted.Rdata")
#load("stan/meristem_brms.Rdata")
#load("stan/chlavg_brms.Rdata")
#load("stan/toughness_brms.Rdata")
#load("stan/thickness_brms.Rdata")
load("stan/htfinal_brms.Rdata")
chill.stan <- read.csv("output/clean_dvr_traits.csv")
chill.stan$species.name <- NA
chill.stan$species.name <- ifelse(chill.stan$species=="ACESAC", "Acer saccharinum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="ALNRUG", "Alnus rugosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPAP", "Betula papyrifera", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPOP", "Betula populifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="CORRAC", "Cornus racemosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SALPUR", "Salix purpurea", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SORAME", "Sorbus americana", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="VIBDEN", "Viburnum dentatum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="FAGGRA", "Fagus grandifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="NYSSYL", "Nyssa sylvatica", chill.stan$species.name)
rmspp <- c("FAGGRA", "NYSSYL")
chill.stan <- chill.stan[!(chill.stan$species%in%rmspp),]
#### Now for mu plots based of bb_analysis/models_stan_plotting.R ###
figpath <- "figures"
figpathmore <- "htfinal90_brms" ### change based on model
cols <- adjustcolor("indianred3", alpha.f = 0.3)
my.pal <- rep(brewer.pal(n = 10, name = "Paired"), 8)
# display.brewer.all()
alphahere = 0.4
xlab <- "Model estimate of change in shoot growth (cm)"
spp <- unique(chill.stan$species)
modelhere <- hfdiff.mod
modelhere <- htdiff.mod
tx <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 2] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select(mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx", "[", i, "]", sep="")
}
tx$parameter<-new.names
chill1 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 3] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill1", "[", i, "]", sep="")
}
chill1$parameter<-new.names
mod.ranef<-full_join(tx, chill1)
chill2 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 4] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill2", "[", i, "]", sep="")
}
chill2$parameter<-new.names
mod.ranef <- full_join(mod.ranef, chill2)
txchill1 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 5] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill1", "[", i, "]", sep="")
}
txchill1$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill1)
txchill2 <- coef(modelhere, prob=c(0.10, 0.90))$species[, c(1, 3:4), 6] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`10%` = Q10) %>%
rename(`90%` = Q90) %>%
dplyr::select( mean, `10%`, `90%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill2", "[", i, "]", sep="")
}
txchill2$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill2)
modoutput <- tidy(modelhere, prob=c(0.9))
#quartz()
source("exp_muplot_brms90.R")
muplotfx(modelhere, "", 8, 8, c(0,5), c(-22, 22) , 23.5, 3.5) ## ht final
htchill2
### Ht final Model - Not intersting
load("stan/htfinal_brms.Rdata")
httx<-round(mean(fixef(htdiff.mod, pars="tx", summary=FALSE)), digits=2) ### 5.06
httxsd<-round(mean(fixef(htdiff.mod, pars="tx")[2]), digits=2) # 4.38
#httxsd <- httxsd[2] - httxsd[1]
htchill1<-round(mean(fixef(htdiff.mod, pars="chill1", summary=FALSE)), digits=2) ### 2.81
htchill1sd<-round(mean(fixef(htdiff.mod, pars="chill1")[2]), digits=2) # 1.55
#htchill1sd<- htchill1sd[2] - htchill1sd[1]
htchill2<-round(mean(fixef(htdiff.mod, pars="chill2", summary=FALSE)), digits=2) ### 1.32
htchill2sd<-round(mean(fixef(htdiff.mod, pars="chill2")[2]), digits=2) # 1.21
htchill2
htchill2sd
