pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
}
par(xpd=TRUE) # so I can plot legend outside
legend(leg1, leg2, sort(unique(gsub("_", " ", chill.stan$species.name))), pch=19,
col=alpha(my.pal[1:spnum], alphahere),
cex=1, bty="n", text.font=3)
dev.off()
muplotfx(modelhere, "", 8, 8, c(0,2), c(-0.8, 0.8) , 1, 1)
spnum
spnum <- length(unique(chill.stan$species))
pdf(file.path(figpath, paste("", nameforfig, figpathmore, ".pdf", sep="")),
width = width, height = height)
par(xpd=FALSE)
par(mar=c(5,7,3,10))
plot(x=NULL,y=NULL, xlim=xlim, yaxt='n', ylim=ylim,
xlab="Model estimate change \nin relative growth rate", ylab="", main=nameforfig)
axis(2, at=1:1, labels=rev(c("Treatment")), las=1)
abline(v=0, lty=2, col="darkgrey")
rownameshere <- c("mu_tx")
ppeffects <- c("mu_tx") # or 1:4 here...
for(i in 1:1){
pos.y<-(1:1)[i]
pos.x<-df[rownameshere[i],"mean"]
lines(df[rownameshere[i],c("25%","75%")],rep(pos.y,2),col="darkgrey")
points(pos.x,pos.y,cex=1.5,pch=19,col="darkblue")
for(spsi in 1:spnum){
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[1:2]
jitt<-runif(1,0.05,0.4)
pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
}
par(xpd=TRUE) # so I can plot legend outside
legend(leg1, leg2, sort(unique(gsub("_", " ", chill.stan$species.name))), pch=19,
col=alpha(my.pal[1:spnum], alphahere),
cex=1, bty="n", text.font=3)
dev.off()
chill.stan$species.name <- NA
chill.stan$species.name <- ifelse(chill.stan$species=="ACESAC", "Acer saccharinum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="ALNRUG", "Alnus rugosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPAP", "Betula papyrifera", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPOP", "Betula populifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="CORRAC", "Cornus racemosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SALPUR", "Salix purpurea", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SORAME", "Sorbus americana", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="VIBDEN", "Viburnum dentatum", chill.stan$species.name)
spnum <- length(unique(chill.stan$species))
pdf(file.path(figpath, paste("", nameforfig, figpathmore, ".pdf", sep="")),
width = width, height = height)
par(xpd=FALSE)
par(mar=c(5,7,3,10))
plot(x=NULL,y=NULL, xlim=xlim, yaxt='n', ylim=ylim,
xlab="Model estimate change \nin relative growth rate", ylab="", main=nameforfig)
axis(2, at=1:1, labels=rev(c("Treatment")), las=1)
abline(v=0, lty=2, col="darkgrey")
rownameshere <- c("mu_tx")
ppeffects <- c("mu_tx") # or 1:4 here...
for(i in 1:1){
pos.y<-(1:1)[i]
pos.x<-df[rownameshere[i],"mean"]
lines(df[rownameshere[i],c("25%","75%")],rep(pos.y,2),col="darkgrey")
points(pos.x,pos.y,cex=1.5,pch=19,col="darkblue")
for(spsi in 1:spnum){
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[1:2]
jitt<-runif(1,0.05,0.4)
pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
}
par(xpd=TRUE) # so I can plot legend outside
legend(leg1, leg2, sort(unique(gsub("_", " ", chill.stan$species.name))), pch=19,
col=alpha(my.pal[1:spnum], alphahere),
cex=1, bty="n", text.font=3)
dev.off()
nameforfig <- "thickness.tx1"
xlim=c(-0.8, 0.8)
ylim=c(0,2)
width=8
height=8
leg1=0.8
leg2=1
spnum <- length(unique(chill.stan$species))
pdf(file.path(figpath, paste("", nameforfig, figpathmore, ".pdf", sep="")),
width = width, height = height)
par(xpd=FALSE)
par(mar=c(5,7,3,10))
plot(x=NULL,y=NULL, xlim=xlim, yaxt='n', ylim=ylim,
xlab="Model estimate change \nin relative growth rate", ylab="", main=nameforfig)
axis(2, at=1:1, labels=rev(c("Treatment")), las=1)
abline(v=0, lty=2, col="darkgrey")
rownameshere <- c("mu_tx")
ppeffects <- c("mu_tx") # or 1:4 here...
for(i in 1:1){
pos.y<-(1:1)[i]
pos.x<-df[rownameshere[i],"mean"]
lines(df[rownameshere[i],c("25%","75%")],rep(pos.y,2),col="darkgrey")
points(pos.x,pos.y,cex=1.5,pch=19,col="darkblue")
for(spsi in 1:spnum){
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[1:2]
jitt<-runif(1,0.05,0.4)
pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
}
par(xpd=TRUE) # so I can plot legend outside
legend(leg1, leg2, sort(unique(gsub("_", " ", chill.stan$species.name))), pch=19,
col=alpha(my.pal[1:spnum], alphahere),
cex=1, bty="n", text.font=3)
dev.off()
as.data.frame(summary(thick.tx1))
spnum <- length(unique(chill.stan$species))
pdf(file.path(figpath, paste("", nameforfig, figpathmore, ".pdf", sep="")),
width = width, height = height)
par(xpd=FALSE)
par(mar=c(5,7,3,10))
plot(x=NULL,y=NULL, xlim=xlim, yaxt='n', ylim=ylim,
xlab="Model estimate change \nin relative growth rate", ylab="", main=nameforfig)
axis(2, at=1:1, labels=rev(c("Treatment")), las=1)
abline(v=0, lty=2, col="darkgrey")
rownameshere <- c("mu_tx")
ppeffects <- c("mu_tx") # or 1:4 here...
for(i in 1:1){
pos.y<-(1:1)[i]
pos.x<-df[rownameshere[i],"mean"]
lines(df[rownameshere[i],c("25%","75%")],rep(pos.y,2),col="darkgrey")
points(pos.x,pos.y,cex=1.5,pch=19,col="darkblue")
for(spsi in 1:spnum){
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[2:3]
jitt<-runif(1,0.05,0.4)
pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
}
par(xpd=TRUE) # so I can plot legend outside
legend(leg1, leg2, sort(unique(gsub("_", " ", chill.stan$species.name))), pch=19,
col=alpha(my.pal[1:spnum], alphahere),
cex=1, bty="n", text.font=3)
dev.off()
for(spsi in 1:spnum){
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[2:2]
jitt<-runif(1,0.05,0.4)
pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
for(i in 1:1){
pos.y<-(1:1)[i]
pos.x<-df[rownameshere[i],"mean"]
lines(df[rownameshere[i],c("25%","75%")],rep(pos.y,2),col="darkgrey")
points(pos.x,pos.y,cex=1.5,pch=19,col="darkblue")
for(spsi in 1:spnum){
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[2:2]
jitt<-runif(1,0.05,0.4)
pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
}
par(xpd=TRUE) # so I can plot legend outside
legend(leg1, leg2, sort(unique(gsub("_", " ", chill.stan$species.name))), pch=19,
col=alpha(my.pal[1:spnum], alphahere),
cex=1, bty="n", text.font=3)
dev.off()
spnum <- length(unique(chill.stan$species))
pdf(file.path(figpath, paste("", nameforfig, figpathmore, ".pdf", sep="")),
width = width, height = height)
par(xpd=FALSE)
par(mar=c(5,7,3,10))
plot(x=NULL,y=NULL, xlim=xlim, yaxt='n', ylim=ylim,
xlab="Model estimate change \nin relative growth rate", ylab="", main=nameforfig)
axis(2, at=1:1, labels=rev(c("Treatment")), las=1)
abline(v=0, lty=2, col="darkgrey")
rownameshere <- c("mu_tx")
ppeffects <- c("mu_tx") # or 1:4 here...
for(i in 1:1){
pos.y<-(1:1)[i]
pos.x<-df[rownameshere[i],"mean"]
lines(df[rownameshere[i],c("25%","75%")],rep(pos.y,2),col="darkgrey")
points(pos.x,pos.y,cex=1.5,pch=19,col="darkblue")
for(spsi in 1:spnum){
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[2:2]
jitt<-runif(1,0.05,0.4)
pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
}
par(xpd=TRUE) # so I can plot legend outside
legend(leg1, leg2, sort(unique(gsub("_", " ", chill.stan$species.name))), pch=19,
col=alpha(my.pal[1:spnum], alphahere),
cex=1, bty="n", text.font=3)
dev.off()
which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[2:2]
for(spsi in 1:spnum)
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[2:2]
pos.sps.i
for(spsi in 1:spnum)
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[1:2]
pos.sps.i
jitt<-runif(1,0.05,0.4)
pos.y.sps.i<-pos.y-jitt
pos.y.sps.i
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
pos.x.sps.i
spsi
for(spsi in 1:spnum){
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[2:2]
jitt<-runif(1,0.05,0.4)
pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
pos.sps.i
pos.y.sps.i
pos.x.sps.i
spnum <- length(unique(chill.stan$species))
pdf(file.path(figpath, paste("", nameforfig, figpathmore, ".pdf", sep="")),
width = width, height = height)
par(xpd=FALSE)
par(mar=c(5,7,3,10))
plot(x=NULL,y=NULL, xlim=xlim, yaxt='n', ylim=ylim,
xlab="Model estimate change \nin relative growth rate", ylab="", main=nameforfig)
axis(2, at=1:1, labels=rev(c("Treatment")), las=1)
abline(v=0, lty=2, col="darkgrey")
rownameshere <- c("mu_tx")
ppeffects <- c("mu_tx") # or 1:4 here...
for(i in 1:1){
pos.y<-(1:1)[i]
pos.x<-df[rownameshere[i],"mean"]
lines(df[rownameshere[i],c("25%","75%")],rep(pos.y,2),col="darkgrey")
points(pos.x,pos.y,cex=1.5,pch=19,col="darkblue")
for(spsi in 1:spnum){
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[2:2]
jitt<-runif(1,0.1,0.2)
pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
}
par(xpd=TRUE) # so I can plot legend outside
legend(leg1, leg2, sort(unique(gsub("_", " ", chill.stan$species.name))), pch=19,
col=alpha(my.pal[1:spnum], alphahere),
cex=1, bty="n", text.font=3)
dev.off()
summary(rgr.rmspp.inter.ncp)$summary
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
source('source/stan_utility.R')
chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
chill.stan$ht.rgr <- ((log(chill.stan$X60dayheight) - log(chill.stan$lo.ht))/60) * 100
chill.stan$thickness <- ((chill.stan$thick1 + chill.stan$thick2)/2)*10
chill.stan <- subset(chill.stan, select=c("thickness", "tx", "chill1", "chill2", "species", "ht.rgr", "id", "chlavg"))
leaf.chill <- chill.stan[!is.na(chill.stan$thickness),]
rgr.chill <- chill.stan[!is.na(chill.stan$thickness),]
leaf.chill <- leaf.chill[(leaf.chill$chill1==0),]
chill.stan <- subset(chill.stan, select=c("thickness", "tx", "chill1", "chill2", "species", "ht.rgr", "id", "chlavg"))
leaf.chill <- chill.stan[!is.na(chill.stan$thickness),]
rgr.chill <- chill.stan[!is.na(chill.stan$ht.rgr),]
leaf.chill <- leaf.chill[(leaf.chill$chill1==0),]
chl.chill <- chill.stan[!is.na(chill.stan$chlavg),]
rgr.tx1 <- stan_glmer(ht.rgr ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2|species), data=rgr.chill)
rgr.tx1
as.data.frame(summary(rgr.tx1))
chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
chill.stan$ht.rgr <- ((log(chill.stan$X60dayheight) - log(chill.stan$lo.ht))/60) * 1000
chill.stan$thickness <- ((chill.stan$thick1 + chill.stan$thick2)/2)*10
chill.stan$ht.rgr <- (log(chill.stan$X60dayheight) - log(chill.stan$lo.ht))
chill.stan$ht.rgr <- (log(chill.stan$X60dayheight) - log(chill.stan$lo.ht)) * 10
chill.stan <- subset(chill.stan, select=c("thickness", "tx", "chill1", "chill2", "species", "ht.rgr", "id", "chlavg"))
rgr.tx1 <- stan_glmer(ht.rgr ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2|species), data=rgr.chill)
rgr.tx1
as.data.frame(summary(rgr.tx1))
chl.tx1 <- stan_glmer(ht.rgr ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2|species), data=chl.chill)
chl.tx1 <- stan_glmer(chlavg ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2|species), data=chl.chill)
as.data.frame(summar(chl.tx1))
as.data.frame(summary(chl.tx1))
chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
chill.stan <- subset(chill.stan, select=c("thickness", "tx", "chill1", "chill2", "species", "ht.rgr", "id", "chlavg", "ht.diff"))
ht.tx1 <- stan_glmer(ht.diff ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2|species), data=ht.chill)
chill.stan <- subset(chill.stan, select=c("thickness", "tx", "chill1", "chill2", "species", "ht.rgr", "id", "chlavg", "ht.diff"))
chill.stan$ht.rgr <- (log(chill.stan$X60dayheight) - log(chill.stan$lo.ht)) * 10
chill.stan$thickness <- ((chill.stan$thick1 + chill.stan$thick2)/2)*10
chill.stan <- subset(chill.stan, select=c("thickness", "tx", "chill1", "chill2", "species", "ht.rgr", "id", "chlavg", "ht.diff"))
ht.chill <- chill.stan[!is.na(chill.stan$ht.diff),]
ht.tx1 <- stan_glmer(ht.diff ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2|species), data=ht.chill)
ht.tx1
as.data.frame(summary(ht.tx1))
chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
chill.stan$ht.rate <- ((chill.stan$X60dayheight - chill.stan$lo.ht)/chill.stan$lo.ht) * 100
chill.stan <- subset(chill.stan, select=c("thickness", "tx", "chill1", "chill2", "species", "ht.rgr", "id", "chlavg", "ht.rate"))
chill.stan$ht.rgr <- (log(chill.stan$X60dayheight) - log(chill.stan$lo.ht)) * 10
chill.stan$thickness <- ((chill.stan$thick1 + chill.stan$thick2)/2)*10
chill.stan <- subset(chill.stan, select=c("thickness", "tx", "chill1", "chill2", "species", "ht.rgr", "id", "chlavg", "ht.rate"))
ht.chill <- chill.stan[!is.na(chill.stan$ht.rate),]
ht.tx1 <- stan_glmer(ht.rate ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2|species), data=ht.chill)
ht.tx1
as.data.frame(summary(ht.tx1))
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(dplyr)
library(lubridate)
library(tidyr)
library(RColorBrewer)
library(egg)
library(brms) ## just for initial glances during experiment!
library(rstan)
# Setting working directory
setwd("~/Documents/git/chillfreeze/analyses/input")
obs <- read.csv("chillobs.csv", header = TRUE)
## Start cleaning a bit...
obs$bb <- as.Date(obs$bb, "%m/%d/%y")
obs$bb <- yday(obs$bb)
obs$lo <- as.Date(obs$lo, "%m/%d/%y")
obs$lo <- yday(obs$lo)
obs$start <- as.Date(obs$start, format = "%m/%d/%y")
obs$budburst <- NA
obs$budburst <- ifelse(obs$start=="2018-12-24", obs$bb + 6, obs$budburst)
obs$budburst <- ifelse(obs$start=="2019-01-07", obs$bb - 7, obs$budburst)
obs$budburst <- ifelse(obs$start=="2019-01-21", obs$bb - 21, obs$budburst)
obs$leafout <- NA
obs$leafout <- ifelse(obs$start=="2018-12-24", obs$lo + 6, obs$leafout)
obs$leafout <- ifelse(obs$start=="2019-01-07", obs$lo - 7, obs$leafout)
obs$leafout <- ifelse(obs$start=="2019-01-21", obs$lo - 21, obs$leafout)
treats <- c(24, 44, 64, 84, 104, 124, 144, 164,
26, 46, 66, 86, 106, 126, 146, 166,
28, 48, 68, 88, 108, 128, 148, 168)
obs$inds <- substr(obs$id, 8, 10)
obs$tx <- ifelse(obs$inds %in% treats, 1, 0)
obs$chill <- NA
obs$chill <- ifelse(obs$start=="2018-12-24", 1, obs$chill)
obs$chill <- ifelse(obs$start=="2019-01-07", 2, obs$chill)
obs$chill <- ifelse(obs$start=="2019-01-21", 3, obs$chill)
obs$ht2 <- as.Date(obs$leafout + 28, origin = obs$start)
obs$ht.mid <- as.Date(obs$leafout + 60, origin = obs$start)
whentomeasure <- subset(obs, select=c("id", "ht.mid"))
whentomeasure <- whentomeasure[!duplicated(whentomeasure),]
#write.csv(whentomeasure, file="~/Desktop/whentomeasureheights.csv", row.names = FALSE)
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
## Breakdown treatments and experiment - 19 February 2019 issues with greenhouse!
if(FALSE){
howfaralong <- obs
howfaralong$chilltx <- NA
howfaralong$chilltx <- ifelse(howfaralong$chill==1, "4wks", howfaralong$chilltx)
howfaralong$chilltx <- ifelse(howfaralong$chill==2, "6wks", howfaralong$chilltx)
howfaralong$chilltx <- ifelse(howfaralong$chill==3, "8wks", howfaralong$chilltx)
howfaralong$chilltx <- paste(howfaralong$chilltx, howfaralong$tx, sep="_")
howfaralong.leafout <- howfaralong[!is.na(howfaralong$lo),]
table(howfaralong.leafout$chilltx)
howfaralong.budburst <- howfaralong[is.na(howfaralong$lo) & !is.na(howfaralong$bb),]
table(howfaralong.budburst$chilltx)
howfaralong.frz <- howfaralong[(howfaralong$tx ==1 & howfaralong$frz!=""),]
table(howfaralong.frz$chilltx)
}
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
chill.stan <- subset(obs, select=c("id", "budburst", "leafout", "tx", "chill", "lo.ht", "X60dayheight", "chl1", "chl2",
"chl3", "chl4", "mg.cm2", "thick1", "thick2"))
chill.stan$chill1 = ifelse(chill.stan$chill == 2, 1, 0)
chill.stan$chill2 = ifelse(chill.stan$chill == 3, 1, 0)
with(chill.stan, table(chill1, chill2))
chill.stan$species <- substr(chill.stan$id, 0, 6)
chill.stan$dvr <- chill.stan$leafout - chill.stan$budburst ### Using this point of code for "drought" effect test
chill.stan$ht.diff <- chill.stan$X60dayheight - chill.stan$lo.ht
chill.stan$chlavg <- apply(chill.stan[,8:11], 1, mean)
write.csv(chill.stan, file="~/Documents/git/chillfreeze/analyses/output/clean_dvr_60dayoutput.csv", row.names=FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
source('source/stan_utility.R')
chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
#testdat <- read.csv("output/fakedata.csv", header=TRUE)
#chill.stan <- chill.stan[!is.na(chill.stan$dvr),]
#nospp <- c("NYSSYL", "FAGGRA") # species to exclude for now because not enough data
#chill.stan <- chill.stan[!(chill.stan$species%in%nospp),]
chill.stan$thickness <- ((chill.stan$thick1 + chill.stan$thick2)/2)*10
chill.stan <- subset(chill.stan, select=c("thickness", "tx", "chill1", "chill2", "species", "ht.rgr", "id", "chlavg", "ht.rate"))
chill.stan$ht.rate <- ((chill.stan$X60dayheight - chill.stan$lo.ht)/chill.stan$lo.ht) * 100
chill.stan$ht.rgr <- (log(chill.stan$X60dayheight) - log(chill.stan$lo.ht)) * 10
chill.stan$ht.perc <- (chill.stan$X60dayheight/chill.stan$lo.ht)*100
chill.stan$thickness <- ((chill.stan$thick1 + chill.stan$thick2)/2)*10
chill.stan <- subset(chill.stan, select=c("thickness", "tx", "chill1", "chill2", "species", "ht.rgr", "id", "chlavg", "ht.perc"))
leaf.chill <- chill.stan[!is.na(chill.stan$thickness),]
leaf.chill <- leaf.chill[(leaf.chill$chill1==1),]
thick.tx1 <- stan_glmer(thickness ~ tx + (tx|species), data=leaf.chill)
thick.tx1
as.data.frame(summary(thick.tx1))
df <- as.data.frame(summary(thick.tx1))
row.names(df) <- c("mu_a", "mu_tx", "a_sp[1]", "mu_tx[1]", "a_sp[2]", "mu_tx[2]", "a_sp[3]", "mu_tx[3]", "a_sp[4]", "mu_tx[4]",
"a_sp[5]", "mu_tx[5]", "a_sp[6]", "mu_tx[6]", "a_sp[7]", "mu_tx[7]", "a_sp[8]", "mu_tx[8]",
"sigma", "sigma_mu_a", "sigma_mu_a_tx", "sigma_mu_tx", "mean_PPD", "log-posterior")
View(df)
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
#### Now for mu plots based of bb_analysis/models_stan_plotting.R ###
figpath <- "figures"
figpathmore <- "thickness"
source("exp_muplot_rstanarm.R")
cols <- adjustcolor("indianred3", alpha.f = 0.3)
my.pal <- rep(brewer.pal(n = 10, name = "Paired"), 10)
# display.brewer.all()
alphahere = 0.4
chill.stan$species.name <- NA
chill.stan$species.name <- ifelse(chill.stan$species=="ACESAC", "Acer saccharinum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="ALNRUG", "Alnus rugosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPAP", "Betula papyrifera", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPOP", "Betula populifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="CORRAC", "Cornus racemosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SALPUR", "Salix purpurea", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SORAME", "Sorbus americana", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="VIBDEN", "Viburnum dentatum", chill.stan$species.name)
sort(unique(chill.stan$species)) # numbers are alphabetical
modelhere <- thick.tx1
nameforfig <- "thickness.tx1"
xlim=c(-0.8, 0.8)
ylim=c(0,2)
width=8
height=8
leg1=0.8
leg2=1
spnum <- length(unique(chill.stan$species))
pdf(file.path(figpath, paste("", nameforfig, figpathmore, ".pdf", sep="")),
width = width, height = height)
par(xpd=FALSE)
par(mar=c(5,7,3,10))
plot(x=NULL,y=NULL, xlim=xlim, yaxt='n', ylim=ylim,
xlab="Model estimate change \nin relative growth rate", ylab="", main=nameforfig)
axis(2, at=1:1, labels=rev(c("Treatment")), las=1)
abline(v=0, lty=2, col="darkgrey")
rownameshere <- c("mu_tx")
ppeffects <- c("mu_tx") # or 1:4 here...
for(i in 1:1){
pos.y<-(1:1)[i]
pos.x<-df[rownameshere[i],"mean"]
lines(df[rownameshere[i],c("25%","75%")],rep(pos.y,2),col="darkgrey")
points(pos.x,pos.y,cex=1.5,pch=19,col="darkblue")
for(spsi in 1:spnum){
pos.sps.i<-which(grepl(paste("[",spsi,"]",sep=""),rownames(df),fixed=TRUE))[2:2]
jitt<-runif(1,0.1,0.2)
pos.y.sps.i<-pos.y-jitt
pos.x.sps.i<-df[pos.sps.i[i],"mean"]
lines(df[pos.sps.i[i],c("25%","75%")],rep(pos.y.sps.i,2),
col=alpha(my.pal[spsi], alphahere))
points(pos.x.sps.i,pos.y.sps.i,cex=0.8, col=alpha(my.pal[spsi], alphahere))
}
}
par(xpd=TRUE) # so I can plot legend outside
legend(leg1, leg2, sort(unique(gsub("_", " ", chill.stan$species.name))), pch=19,
col=alpha(my.pal[1:spnum], alphahere),
cex=1, bty="n", text.font=3)
dev.off()
as.data.frame(summary(chl.tx1))
chl.tx1 <- stan_glmer(chlavg ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2|species), data=chl.chill) ## Actually interesting!!! Woohoo!!!
chl.chill <- chill.stan[!is.na(chill.stan$chlavg),]
chl.tx1 <- stan_glmer(chlavg ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2|species), data=chl.chill) ## Actually interesting!!! Woohoo!!!
as.data.frame(summary(chl.tx1))
df <- as.data.frame(summary(chill.tx1))
row.names(df) <- c("mu_a", "mu_tx", "a_sp[1]", "mu_tx[1]", "a_sp[2]", "mu_tx[2]", "a_sp[3]", "mu_tx[3]", "a_sp[4]", "mu_tx[4]",
"a_sp[5]", "mu_tx[5]", "a_sp[6]", "mu_tx[6]", "a_sp[7]", "mu_tx[7]", "a_sp[8]", "mu_tx[8]",
"sigma", "sigma_mu_a", "sigma_mu_a_tx", "sigma_mu_tx", "mean_PPD", "log-posterior")
df <- as.data.frame(summary(chl.tx1))
row.names(df) <- c("mu_a", "mu_tx", "a_sp[1]", "mu_tx[1]", "a_sp[2]", "mu_tx[2]", "a_sp[3]", "mu_tx[3]", "a_sp[4]", "mu_tx[4]",
"a_sp[5]", "mu_tx[5]", "a_sp[6]", "mu_tx[6]", "a_sp[7]", "mu_tx[7]", "a_sp[8]", "mu_tx[8]",
"sigma", "sigma_mu_a", "sigma_mu_a_tx", "sigma_mu_tx", "mean_PPD", "log-posterior")
