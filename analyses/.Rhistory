ylab("Relative growth rate (cm/days)") +
geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), length.out=5), 15.4, 17.5))) +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="Treatments", values=c(0.1, 1), labels=chill.bars6$tx) +
guides(fill=FALSE) +
ggtitle("B. Six weeks chilling") + coord_cartesian(xlim=c(1, 8), ylim=c(0,101), expand=TRUE)
dvrbar8 <- ggplot(chill.bars8, aes(x=code, y=dvrmean, fill=code, alpha=tx)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")#,
#axis.title.y = element_blank(),
#axis.text.y = element_blank(),
#axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Relative growth rate (cm/days)") +
geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), length.out=5), 13.2, 16.9))) +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="", values=c(0.1, 1), labels=chill.bars8$tx) +
guides(fill=FALSE) +
ggtitle("C. Eight weeks chilling") + coord_cartesian(xlim=c(1, 8), ylim=c(0,101), expand=TRUE)
dvrbarplot <- grid.arrange(dvrbar4, dvrbar6, dvrbar8, ncol=3, widths=c(1, 1, 1.3))
dvrbar4 <- ggplot(chill.bars4, aes(x=code, y=dvrmean, fill=code, alpha=tx)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position = "none",
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Relative growth rate (cm/days)") +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), by=5), 16.0, 18.8))) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="Treatments", values=c(0.1, 1), labels=chill.bars4$tx) +
guides(fill=FALSE) +
ggtitle("A. Four weeks chilling")  + coord_cartesian(xlim=c(1, 8), ylim=c(-5,85), expand=TRUE)
dvrbar6 <- ggplot(chill.bars6, aes(x=code, y=dvrmean, fill=code, alpha=tx)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position = "none",
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")#,
#axis.title.y = element_blank(),
#axis.text.y = element_blank(),
#axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Relative growth rate (cm/days)") +
geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), length.out=5), 15.4, 17.5))) +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="Treatments", values=c(0.1, 1), labels=chill.bars6$tx) +
guides(fill=FALSE) +
ggtitle("B. Six weeks chilling") + coord_cartesian(xlim=c(1, 8), ylim=c(-5,85), expand=TRUE)
dvrbar8 <- ggplot(chill.bars8, aes(x=code, y=dvrmean, fill=code, alpha=tx)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")#,
#axis.title.y = element_blank(),
#axis.text.y = element_blank(),
#axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Relative growth rate (cm/days)") +
geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), length.out=5), 13.2, 16.9))) +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="", values=c(0.1, 1), labels=chill.bars8$tx) +
guides(fill=FALSE) +
ggtitle("C. Eight weeks chilling") + coord_cartesian(xlim=c(1, 8), ylim=c(-5,85), expand=TRUE)
dvrbarplot <- grid.arrange(dvrbar4, dvrbar6, dvrbar8, ncol=3, widths=c(1, 1, 1.3))
ggsave("figures/rgrprebudset_speciesplot.png",width=30, height=12,units="cm",bg = "white",dpi=500, plot=dvrbarplot)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(dplyr)
library(lubridate)
library(tidyr)
library(RColorBrewer)
library(egg)
library(brms) ## just for initial glances during experiment!
library(rstan)
# Setting working directory
setwd("~/Documents/git/chillfreeze/analyses/input")
obs <- read.csv("chillobs.csv", header = TRUE)
## Start cleaning a bit...
obs$bb <- as.Date(obs$bb, "%m/%d/%y")
obs$bb <- yday(obs$bb)
obs$lo <- as.Date(obs$lo, "%m/%d/%y")
obs$lo <- yday(obs$lo)
obs$start <- as.Date(obs$start, format = "%m/%d/%y")
obs$budburst <- NA
obs$budburst <- ifelse(obs$start=="2018-12-24", obs$bb + 6, obs$budburst)
obs$budburst <- ifelse(obs$start=="2019-01-07", obs$bb - 7, obs$budburst)
obs$budburst <- ifelse(obs$start=="2019-01-21", obs$bb - 21, obs$budburst)
obs$leafout <- NA
obs$leafout <- ifelse(obs$start=="2018-12-24", obs$lo + 6, obs$leafout)
obs$leafout <- ifelse(obs$start=="2019-01-07", obs$lo - 7, obs$leafout)
obs$leafout <- ifelse(obs$start=="2019-01-21", obs$lo - 21, obs$leafout)
treats <- c(24, 44, 64, 84, 104, 124, 144, 164,
26, 46, 66, 86, 106, 126, 146, 166,
28, 48, 68, 88, 108, 128, 148, 168)
obs$inds <- substr(obs$id, 8, 10)
obs$tx <- ifelse(obs$inds %in% treats, 1, 0)
obs$chill <- NA
obs$chill <- ifelse(obs$start=="2018-12-24", 1, obs$chill)
obs$chill <- ifelse(obs$start=="2019-01-07", 2, obs$chill)
obs$chill <- ifelse(obs$start=="2019-01-21", 3, obs$chill)
obs$ht2 <- as.Date(obs$leafout + 28, origin = obs$start)
obs$ht.mid <- as.Date(obs$leafout + 60, origin = obs$start)
whentomeasure <- subset(obs, select=c("id", "ht.mid"))
whentomeasure <- whentomeasure[!duplicated(whentomeasure),]
#write.csv(whentomeasure, file="~/Desktop/whentomeasureheights.csv", row.names = FALSE)
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
## Breakdown treatments and experiment - 19 February 2019 issues with greenhouse!
if(FALSE){
howfaralong <- obs
howfaralong$chilltx <- NA
howfaralong$chilltx <- ifelse(howfaralong$chill==1, "4wks", howfaralong$chilltx)
howfaralong$chilltx <- ifelse(howfaralong$chill==2, "6wks", howfaralong$chilltx)
howfaralong$chilltx <- ifelse(howfaralong$chill==3, "8wks", howfaralong$chilltx)
howfaralong$chilltx <- paste(howfaralong$chilltx, howfaralong$tx, sep="_")
howfaralong.leafout <- howfaralong[!is.na(howfaralong$lo),]
table(howfaralong.leafout$chilltx)
howfaralong.budburst <- howfaralong[is.na(howfaralong$lo) & !is.na(howfaralong$bb),]
table(howfaralong.budburst$chilltx)
howfaralong.frz <- howfaralong[(howfaralong$tx ==1 & howfaralong$frz!=""),]
table(howfaralong.frz$chilltx)
}
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ##
chill.stan <- subset(obs, select=c("id", "budburst", "leafout", "tx", "chill", "lo.ht", "X60dayheight", "chl1", "chl2",
"chl3", "chl4", "mg.cm2", "thick1", "thick2", "tough1", "tough2",
"ht.prebudset", "ht.date"))
chill.stan$chill1 = ifelse(chill.stan$chill == 2, 1, 0)
chill.stan$chill2 = ifelse(chill.stan$chill == 3, 1, 0)
with(chill.stan, table(chill1, chill2))
chill.stan$species <- substr(chill.stan$id, 0, 6)
chill.stan$dvr <- chill.stan$leafout - chill.stan$budburst ### Using this point of code for "drought" effect test
chill.stan$ht.diff <- chill.stan$X60dayheight - chill.stan$lo.ht
chill.stan$chlavg <- apply(chill.stan[,8:11], 1, mean)
chill.stan$tough <- (chill.stan$tough1 + chill.stan$tough2)/2
chill.stan$tough.date <- NA
chill.stan$tough.date <- ifelse(chill.stan$chill==1, (170+6), chill.stan$tough.date)
chill.stan$tough.date <- ifelse(chill.stan$chill==2, (184-7), chill.stan$tough.date)
chill.stan$tough.date <- ifelse(chill.stan$chill==3, (184-21), chill.stan$tough.date)
chill.stan$tough.age <- chill.stan$tough.date - chill.stan$lo
#chill.stan$ht.late <- chill.stan$ht.prebudset - chill.stan$lo.ht
chill.stan$ht.date.new <- NA
chill.stan$ht.date.new <- ifelse(chill.stan$chill==1, (chill.stan$ht.date+6), chill.stan$tough.date)
chill.stan$ht.date.new <- ifelse(chill.stan$chill==2, (chill.stan$ht.date-7), chill.stan$tough.date)
chill.stan$ht.date.new <- ifelse(chill.stan$chill==3, (chill.stan$ht.date-21), chill.stan$tough.date)
chill.stan$rgr_prebudset <- (chill.stan$ht.prebudset - chill.stan$lo.ht)/(chill.stan$ht.date.new - chill.stan$leafout)*100
write.csv(chill.stan, file="~/Documents/git/chillfreeze/analyses/output/clean_dvr_60dayoutput.csv", row.names=FALSE)
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(bayesplot) ## for plotting
library(egg) ## for plotting
library(shinystan)
library(rstanarm)
library(rstan)
library(brms)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
source('source/stan_utility.R')
chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
#chill.stan <- read.csv("output/fakedata_height.csv", header=TRUE)
#chill.stan$ht.diff <- chill.stan$X60dayheight - chill.stan$lo.ht
#chill.stan <- chill.stan[!is.na(chill.stan$ht.diff),]
#chill.stan$ht.rgr <- (log(chill.stan$X60dayheight) - log(chill.stan$lo.ht)) * 10
#chill.stan <- chill.stan[!is.na(chill.stan$ht.rgr),]
#chill.stan$thickness <- ((chill.stan$thick1 + chill.stan$thick2)/2)*10
#chill.stan <- chill.stan[!is.na(chill.stan$thickness),]
#chill.stan <- chill.stan[!is.na(chill.stan$mg.cm2),]
#chill.stan <- chill.stan[!is.na(chill.stan$chlavg),]
#chill.stan <- chill.stan[!is.na(chill.stan$ht.rgr),]
#rmspp <- c("FAGGRA", "NYSSYL")
#chill.stan <- chill.stan[!(chill.stan%in%rmspp),]
#chill.stan <- chill.stan[!is.na(chill.stan$tough),]
chill.stan <- chill.stan[!is.na(chill.stan$rgr_prebudset),]
ht.rgr.new <- brm(rgr_prebudset ~ tx*chill1 + tx*chill2 + (tx*chill1 + tx*chill2|species), data=chill.stan,
iter=4000, warmup=2500, control=list(max_treedepth = 15,adapt_delta = 0.99))
save(ht.rgr.new, file="~/Documents/git/chillfreeze/analyses/stan/rgr_prebudset_brms.Rdata")
ht.rgr.new
rm(list=ls())
options(stringsAsFactors = FALSE)
# Load libraries
library(RColorBrewer)
library(rstan)
library(dplyr)
library(broom)
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
# Set working directory
setwd("~/Documents/git/chillfreeze/analyses")
## load the model
#load("stan/dvr_inter_ncp_skewnormal.Rda")
#load("stan/dvr_inter_ncp_drought.Rda")
#load("stan/toughness_brms.Rdata")
load("stan/rgr_prebudset_brms.Rdata")
#chill.stan <- read.csv("output/clean_dvr_drought.csv", header=TRUE)
chill.stan <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
chill.stan <- chill.stan[!is.na(chill.stan$ht.prebudset),]
chill.stan$species.name <- NA
chill.stan$species.name <- ifelse(chill.stan$species=="ACESAC", "Acer saccharinum", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="ALNRUG", "Alnus rugosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPAP", "Betula papyrifera", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="BETPOP", "Betula populifolia", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="CORRAC", "Cornus racemosa", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SALPUR", "Salix purpurea", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="SORAME", "Sorbus americana", chill.stan$species.name)
chill.stan$species.name <- ifelse(chill.stan$species=="VIBDEN", "Viburnum dentatum", chill.stan$species.name)
#chill.stan$species.name <- ifelse(chill.stan$species=="FAGGRA", "Fagus grandifolia", chill.stan$species.name)
#chill.stan$species.name <- ifelse(chill.stan$species=="NYSSYL", "Nyssa sylvatica", chill.stan$species.name)
#### Now for mu plots based of bb_analysis/models_stan_plotting.R ###
figpath <- "figures"
figpathmore <- "rgr_brms" ### change based on model
source("exp_muplot_brms.R")
cols <- adjustcolor("indianred3", alpha.f = 0.3)
my.pal <- rep(brewer.pal(n = 10, name = "Paired"), 8)
# display.brewer.all()
alphahere = 0.4
xlab <- "Model estimate of change in \nrelative growth rate (cm/days)" ## change based on model
#sumer.ni <- summary()$summary
#sumer.ni[grep("mu_", rownames(sumer.ni)),]
#sort(unique(chill.stan$species)) # numbers are alphabetical
spp <- unique(chill.stan$species)
modelhere <- ht.rgr.new
tx <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 2] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select(mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx", "[", i, "]", sep="")
}
tx$parameter<-new.names
chill1 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 3] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill1", "[", i, "]", sep="")
}
chill1$parameter<-new.names
mod.ranef<-full_join(tx, chill1)
chill2 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 4] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("chill2", "[", i, "]", sep="")
}
chill2$parameter<-new.names
mod.ranef <- full_join(mod.ranef, chill2)
txchill1 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 5] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill1", "[", i, "]", sep="")
}
txchill1$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill1)
txchill2 <- coef(modelhere, prob=c(0.25, 0.75))$species[, c(1, 3:4), 6] %>%
as.data.frame() %>%
round(digits = 2) %>%
rename(mean = Estimate) %>%
rename(`25%` = Q25) %>%
rename(`75%` = Q75) %>%
dplyr::select( mean, `25%`, `75%`)
new.names<-NULL
for(i in 1:length(spp)){
new.names[i]<-paste("tx:chill2", "[", i, "]", sep="")
}
txchill2$parameter<-new.names
mod.ranef<-full_join(mod.ranef, txchill2)
modoutput <- tidy(modelhere, prob=c(0.5))
#quartz()
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-10, 10) , 10.5, 3.5)
muplotfx(modelhere, "", 8, 8, c(0,5), c(-20, 20) , 21, 3.5)
#quartz()
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-10, 10) , 10.5, 3.5)
muplotfx(modelhere, "", 8, 8, c(0,5), c(-20, 25) , 21, 3.5)
#quartz()
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-10, 10) , 10.5, 3.5)
muplotfx(modelhere, "", 8, 8, c(0,5), c(-20, 30) , 31, 3.5)
#quartz()
#muplotfx(modelhere, "", 8, 8, c(0,5), c(-10, 10) , 10.5, 3.5)
muplotfx(modelhere, "", 8, 8, c(0,5), c(-20, 30) , 32, 3.5)
rm(list=ls()) # remove everything currently held in the R memory
options(stringsAsFactors=FALSE)
graphics.off()
# Load libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(cowplot)
library(RColorBrewer)
# Set Working Directory
setwd("~/Documents/git/chillfreeze/analyses")
chillfrz <- read.csv("output/clean_dvr_60dayoutput.csv", header=TRUE)
rmspp <- c("NYSSYL", "FAGGRA")
chillfrz <- chillfrz[!(chillfrz$species%in%rmspp),]
cols <- colorRampPalette(brewer.pal(8,"Dark2"))(8)
dvrbar <- subset(chillfrz, select=c("species", "chill", "rgr_prebudset", "tx", "budburst"))
dvrbar <- na.omit(dvrbar)
dvrbar <- dvrbar[!duplicated(dvrbar),]
dvrbar$tx <-ifelse(dvrbar$tx==0, "control", "treatment")
dvrbar$species.name <- NA
dvrbar$species.name <- ifelse(dvrbar$species=="ACESAC", "Acer saccharinum", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="ALNRUG", "Alnus rugosa", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="BETPAP", "Betula papyrifera", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="BETPOP", "Betula populifolia", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="CORRAC", "Cornus racemosa", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="SALPUR", "Salix purpurea", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="SORAME", "Sorbus americana", dvrbar$species.name)
dvrbar$species.name <- ifelse(dvrbar$species=="VIBDEN", "Viburnum dentatum", dvrbar$species.name)
dvrbar$code <- reorder(dvrbar$species, dvrbar$budburst)
chill.bars4 <- dvrbar[(dvrbar$chill==1),]
chill.bars6 <- dvrbar[(dvrbar$chill==2),]
chill.bars8 <- dvrbar[(dvrbar$chill==3),]
chill.bars4$dvrmean <- ave(chill.bars4$rgr_prebudset, chill.bars4$tx, chill.bars4$species)
chill.bars4$dvrsd <- ave(chill.bars4$rgr_prebudset, chill.bars4$tx, chill.bars4$species, FUN=sd)
chill.bars4$ymin <- chill.bars4$dvrmean-chill.bars4$dvrsd
chill.bars4$ymax <- chill.bars4$dvrmean+chill.bars4$dvrsd
chill.bars4$meancont <- mean(chill.bars4$rgr_prebudset[chill.bars4$tx=="control"]) # 0.44
chill.bars4$meantx <- mean(chill.bars4$rgr_prebudset[chill.bars4$tx=="treatment"]) # 0.38
dvrbar4 <- ggplot(chill.bars4, aes(x=code, y=dvrmean, fill=code, alpha=tx)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position = "none",
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")) +
xlab("") +
ylab("Relative growth rate (cm/days)") +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), by=5), 16.0, 18.8))) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="Treatments", values=c(0.1, 1), labels=chill.bars4$tx) +
guides(fill=FALSE) +
ggtitle("A. Four weeks chilling")  + coord_cartesian(xlim=c(1, 8), ylim=c(-5,85), expand=TRUE)
chill.bars6$dvrmean <- ave(chill.bars6$rgr_prebudset, chill.bars6$tx, chill.bars6$species)
chill.bars6$dvrsd <- ave(chill.bars6$rgr_prebudset, chill.bars6$tx, chill.bars6$species, FUN=sd)
chill.bars6$ymin <- chill.bars6$dvrmean-chill.bars6$dvrsd
chill.bars6$ymax <- chill.bars6$dvrmean+chill.bars6$dvrsd
chill.bars6$meancont <- mean(chill.bars6$rgr_prebudset[chill.bars6$tx=="control"]) #15.4
chill.bars6$meantx <- mean(chill.bars6$rgr_prebudset[chill.bars6$tx=="treatment"]) #17.5
dvrbar6 <- ggplot(chill.bars6, aes(x=code, y=dvrmean, fill=code, alpha=tx)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
legend.position = "none",
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")#,
#axis.title.y = element_blank(),
#axis.text.y = element_blank(),
#axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Relative growth rate (cm/days)") +
geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), length.out=5), 15.4, 17.5))) +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="Treatments", values=c(0.1, 1), labels=chill.bars6$tx) +
guides(fill=FALSE) +
ggtitle("B. Six weeks chilling") + coord_cartesian(xlim=c(1, 8), ylim=c(-5,85), expand=TRUE)
chill.bars8$dvrmean <- ave(chill.bars8$rgr_prebudset, chill.bars8$tx, chill.bars8$species)
chill.bars8$dvrsd <- ave(chill.bars8$rgr_prebudset, chill.bars8$tx, chill.bars8$species, FUN=sd)
chill.bars8$ymin <- chill.bars8$dvrmean-chill.bars8$dvrsd
chill.bars8$ymax <- chill.bars8$dvrmean+chill.bars8$dvrsd
chill.bars8$meancont <- mean(chill.bars8$rgr_prebudset[chill.bars8$tx=="control"]) #13.2
chill.bars8$meantx <- mean(chill.bars8$rgr_prebudset[chill.bars8$tx=="treatment"]) #16.9
dvrbar8 <- ggplot(chill.bars8, aes(x=code, y=dvrmean, fill=code, alpha=tx)) +
geom_bar(stat="identity", position=position_dodge()) +
geom_errorbar(aes(ymin=ymin, ymax=ymax),width = 0.2, position=position_dodge(0.9)) +
theme(panel.background = element_blank(), axis.line = element_line(colour = "black"),
legend.text.align = 0,
#legend.position = "none",
axis.text.x = element_text(face = "italic", angle=45, hjust=1),
legend.key = element_rect(colour = "transparent", fill = "white")#,
#axis.title.y = element_blank(),
#axis.text.y = element_blank(),
#axis.ticks.y = element_blank()
) +
xlab("") +
ylab("Relative growth rate (cm/days)") +
geom_hline(aes(yintercept = meancont), col="black", alpha=0.3, linetype="dashed") +
geom_hline(aes(yintercept = meantx), col="black", alpha=1, linetype="dashed") +
#scale_y_continuous(breaks = sort(c(seq(min(5), max(35), length.out=5), 13.2, 16.9))) +
scale_fill_manual(name="Species", values=cols,
labels=chill.bars4$code) +
scale_x_discrete(labels=c("ACESAC"="Acer saccharinum",
"ALNRUG"="Alnus rugosa",
"BETPAP"="Betula papyrifera",
"BETPOP"="Betula populifolia",
"CORRAC"="Cornus racemosa",
"SALPUR"="Salix purpurea",
"SORAME"="Sorbus americana",
"VIBDEN"="Viburnum dentatum")) +
scale_alpha_manual(name="", values=c(0.1, 1), labels=chill.bars8$tx) +
guides(fill=FALSE) +
ggtitle("C. Eight weeks chilling") + coord_cartesian(xlim=c(1, 8), ylim=c(-5,85), expand=TRUE)
quartz()
dvrbarplot <- grid.arrange(dvrbar4, dvrbar6, dvrbar8, ncol=3, widths=c(1, 1, 1.3))
ggsave("figures/rgrprebudset_speciesplot.png",width=30, height=12,units="cm",bg = "white",dpi=500, plot=dvrbarplot)
